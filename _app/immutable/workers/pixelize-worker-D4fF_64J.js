(function(){"use strict";var x=class{pixelate(r,t,l){if(t<=1)return r;const{width:n,height:s,data:o}=r,e=new ImageData(Math.floor(n/t),Math.floor(s/t));for(let a=0;a<e.height;a++)for(let c=0;c<e.width;c++){const i=c*t,g=a*t,f=Math.min(i+t,n),d=Math.min(g+t,s);let w=0,C=0,M=0,v=0,h=0;for(let b=g;b<d;b++)for(let m=i;m<f;m++){const D=(b*n+m)*4;w+=o[D],C+=o[D+1],M+=o[D+2],v+=o[D+3],h++}const P=w/h,y=C/h,I=M/h,p=v/h,u=(a*e.width+c)*4;e.data[u]=P,e.data[u+1]=y,e.data[u+2]=I,e.data[u+3]=p}return l?this.applyPalette(e,l):e}applyPalette(r,t){if(t.length===0)return r;const{width:l,height:n,data:s}=r,o=new ImageData(l,n),e=o.data;for(let a=0;a<s.length;a+=4){const c={r:s[a],g:s[a+1],b:s[a+2]};let i=t[0],g=this.getColorDist(c,i);for(let f=1;f<t.length;f++){const d=this.getColorDist(c,t[f]);d<g&&(g=d,i=t[f])}e[a]=i.r,e[a+1]=i.g,e[a+2]=i.b,e[a+3]=255}return o}getColorDist(r,t){const l=r.r-t.r,n=r.g-t.g,s=r.b-t.b;return Math.sqrt(l*l+n*n+s*s)}};self.onmessage=function(r){const{imageData:t,pixelSize:l,palette:n}=r.data,s=new x;let o=s.pixelate(t,l);n&&n.length!==0&&(o=s.applyPalette(o,n)),self.postMessage(o,{transfer:[o.data.buffer]})}})();
